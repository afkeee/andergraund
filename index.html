<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kamp muusikuid, tegemas muusikat!">
    <meta name="robots" content="index,follow">
    <link rel="canonical" href="https://andergraund.ee/#uudised">
    <title>Andergraund Disc.</title>
    <link rel="icon" type="image/x-icon" href="./images/AA.ico">
    <link rel="stylesheet" href="andergraund-styles.css">
</head>
<body>
    <div class="video-container">
        <!-- Upper video -->
        <video autoplay muted loop class="upper-video">
            <source src="./assets/andertaustprof.webm" type="video/webm">
        </video>

        <!-- Lower video -->
        <video autoplay muted loop class="lower-video" id="lowerVid">
            <source type="video/webm" src="./assets/anderupsidedown.webm">
        </video>
    </div>

    <main>
        <section class="header-container">
            <header>
                <div class="header-content">
                    <nav>
                        <a href="#uudised" onclick="changeArticle('uudised')">Uudised</a>
                        <a href="#artists" onclick="changeArticle('artists')">Artistid</a>
                    </nav>
                    <nav>
                        <a href="#info" onclick="changeArticle('info')">Info</a>
                        <a href="#contact" onclick="changeArticle('contact')">Kontakt</a>
                    </nav>
                </div>
            </header>
        </section>
        <section class="content">
            <div class="content-scroll" id="article-switch">
                <article id="uudised">

                    <div class="blog-scroll">
                        <div class="blog-card" id="blog-1">
                            <div class="blog-text">
                                <h2>"Sundei esimene lugu!" 13.11.24</h2>
                                <p>
                                    Andergraund Disc.'i teine väljalase on kohal! Sundei lasi välja esimese drum & bass loo ning see on nüüd kuulatav pea igal platformil.
                                </p>
                                <div class="artist-links">
                                    <nav>
                                        <a class="img-link" href="https://open.spotify.com/album/2cB1w2Y00kLyKogJN93aqD?referral=labelaffiliate" target="_blank" rel="noopener noreferrer">
                                            <img src="./images/spotify.png" width="48">
                                        </a>
                                    </nav>
                                    <nav>
                                        <a class="img-link" href="https://music.apple.com/us/album/beyond-favourites-single/1779891085" target="_blank" rel="noopener noreferrer">
                                            <img src="./images/applemusic.png" width="48">
                                        </a>
                                    </nav>
                                </div>
                            </div>
                            <div class="blog-image">
                                <iframe style="border-radius:12px" src="https://open.spotify.com/embed/album/2cB1w2Y00kLyKogJN93aqD?utm_source=generator" width="100%" height="352" frameBorder="0" allow="encrypted-media; fullscreen" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>                            </div>
                            </div>
                        <div class="blog-card" id="blog-1">
                            <div class="blog-text">
                                <h2>"ossu, afke - "Changed For You" nüüd väljas!" 01.10.24</h2>
                                <p>
                                    Ossu ja afke tegid koos ühe emotsionaalse loo ning see on nüüd kuulatav pea igal platformil. See on ka Andergraund Disc.'i esimene väljalase!
                                </p>
                                <div class="artist-links">
                                    <nav>
                                        <a class="img-link" href="https://open.spotify.com/track/3Ev3oy10Te5zUcSYcr3klQ?si=f78e3dae9ac04b08" target="_blank" rel="noopener noreferrer">
                                            <img src="./images/spotify.png" width="48">
                                        </a>
                                    </nav>
                                    <nav>
                                        <a class="img-link" href="https://www.youtube.com/watch?v=povrQhdFP6o&list=OLAK5uy_kLXsgnilG2j-WinkW88Nv9diixSivEedY&index=1" target="_blank" rel="noopener noreferrer">
                                            <img src="./images/youtube.webp" width="48" height="48">
                                        </a>
                                    </nav>
                                    <nav>
                                        <a class="img-link" href="https://music.apple.com/us/album/changed-for-you/1770626555?i=1770626556" target="_blank" rel="noopener noreferrer">
                                            <img src="./images/applemusic.png" width="48" height="48">
                                        </a>
                                    </nav>
                                    <nav>
                                        <a class="img-link" href="https://tidal.com/browse/track/389310045" target="_blank" rel="noopener noreferrer">
                                            <img src="./images/tidal.webp" width="48" height="48">
                                        </a>
                                    </nav>
                                </div>
                            </div>
                            <div class="blog-image">
                                <iframe style="border-radius:12px" src="https://open.spotify.com/embed/album/6twhhigzmlBXk8U2hvw4kt?utm_source=generator" width="100%" height="352" frameBorder="0" allow="encrypted-media; fullscreen" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>                            </div>
                            </div>
                        <div class="blog-card" id="blog-1">
                            <div class="blog-text">
                                <h2>"Veebileht" 27.09.24</h2>
                                <p>
                                    andergraund.ee sai alguse.
                                </p>
                            </div>
                        </div>
                        <div class="blog-card" id="blog-2">
                            <div class="blog-text">
                                <h2>"Ander algus!" 10.09.24</h2>
                                <p>
                                    10. juulil avasime Discordi serveri lootes sinna koguda ainult muusikuid.
                                </p>
                            </div>
                        </div>
                    </div>

                </article>
                <article id="artists">
                    <button class="artists-slide-button slide-left" type="button" id="arrow-up" onclick="changeSlide(-1)"><</button>
                    <div class="artist-card fade hidden" id="ossu">
                        <div class="artist-info">
                            <h2>ossu</h2>
                            <p>
                                16-aastane Singer/Songwriter Tartust.
                            </p>
                            <div class="artist-links">
                                <nav>
                                    <a href="https://open.spotify.com/artist/76TeHac6XxvNUNQICj9WNQ?si=dwSYY2uPSdq_yi_RIQ-fYQ" target="_blank" rel="noopener noreferrer">Spotify</a>
                                </nav>
                                <nav>
                                    <a href="https://www.instagram.com/ossu.archive/" target="_blank" rel="noopener noreferrer">Instagram</a>
                                </nav>
                            </div>
                        </div>
                        <img src="/images/ossubanner.jpg" alt="">
                    </div>
                    <div class="artist-card fade hidden" id="metropol">
                        <div class="artist-info">
                            <h2>Metropol</h2>
                            <p>
                                Indie-rock (kuigi nad ise kirjeldavad ennast kui "avangard proge dream indie alternatiiv art grunge noise audiosound shoegaze post rokk") ansambel Viljandist
                            </p>
                            <div class="artist-links">
                                <nav>
                                    <a href="https://www.instagram.com/metropolb2nd/" target="_blank" rel="noopener noreferrer">Instagram</a>
                                </nav>
                            </div>
                        </div>
                        <img src="images/456898940_1941772729609968_3413986241813720113_n.jpg" alt="">
                    </div>
                    <div class="artist-card fade hidden" id="afke">
                        <div class="artist-info">
                            <h2>afke</h2>
                            <p>
                                18-aastane EDM/lo-fi produtsent ning trummar.
                            </p>
                            <div class="artist-links">
                                <nav>
                                    <a href="https://afke.ee/music" target="_blank" rel="noopener noreferrer">afke.ee</a>
                                </nav>
                            </div>
                        </div>
                        <img src="./images/raccoonpixelsortafke.jpg" alt="">
                    </div>
                    <div class="artist-card fade hidden" id="trellid">
                        <div class="artist-info">
                            <h2>The Akud of The Trellid</h2>
                            <p>
                                Experimental-rock ansambel Viljandist
                            </p>
                            <div class="artist-links">
                                <nav>
                                    <a href="https://open.spotify.com/artist/1SJlsc4hSX8UzIKz5ml8WA?si=83ENanfFRBSIqU21JC1dJQ" target="_blank" rel="noopener noreferrer">Spotify</a>
                                </nav>
                            </div>
                        </div>
                        <img src="/images/trellid2.webp" alt="">
                    </div>
                    <div class="artist-card fade hidden" id="sundei">
                        <div class="artist-info">
                            <h2>sundei</h2>
                            <p>
                                Produtsent ja vabakutseline muusik Tartust  
                            </p>
                            <div class="artist-links">
                                <nav>
                                    <a href="https://sundei.ee" target="_blank" rel="noopener noreferrer">sundei.ee</a>
                                </nav>
                                <nav>
                                    <a href="https://instagram.com/sundeinotfound" target="_blank" rel="noopener noreferrer">Instagram</a>
                                </nav>
                            </div>
                        </div>
                        <img src="/images/sundie.png" alt="">
                    </div>
                    <button class="artists-slide-button slide-right" type="button" id="arrow-down" onclick="changeSlide(1)">></button>
                </article>
                <article id="info">
                    <img src="" alt="">
                    <p class="info-text">Andergraund on kamp muusikuid, tegemas muusikat! Me pakume vabadust artistile teha oma muusikaga mida iganes ilma, et me võtaksime neilt mingeid õiguseid ära.</p>
                    <p class="info-text">Andergraundi trall algas sellest, kui Ruudil ja Tauril tuli mõte teha discord, kuhu kutsuda kokku kõik muusikud, keda nad tunnevad. Selle käigus tuli väike mõte teha sellest juba plaadifirma, et aidata kuttidel ka muusika üles saada.</p>
                    <img src="" alt="">
                </article>
                <article id="contact" >
                    <div class="contact-container">
                        <div class="contact-header">
                            <h3>
                                andergraund@gmail.com
                            </h3>
                        </div>
                        <div class="contact-nav">
                            <nav>
                                <a class="img-link" href="mailto: andergraunddisc@gmail.com" target="_blank" rel="noopener noreferrer">
                                    <img src="./images/mail.png" width="48">
                                </a>
                            </nav>
                            <nav>
                                <a class="img-link" href="https://discord.gg/3UHjZCXvYK" target="_blank" rel="noopener noreferrer">
                                    <img src="./images/discord-white-icon.webp" width="48">
                                </a>
                            </nav>
                            <nav>
                                <a class="img-link" href="https://www.instagram.com/andergraunddisc/" target="_blank" rel="noopener noreferrer">
                                    <img src="./images/instagram.png" width="48">
                                </a>
                            </nav>
                            <nav>
                                <a class="img-link" href="https://soundcloud.com/andergraunddisc" target="_blank" rel="noopener noreferrer">
                                    <img src="./images/soundcloud.png" width="48" height="48">
                                </a>
                            </nav>
                        </div>
                        <div>
                        </div>
                    </div>
                </article>
            </div>
        </section>
    </main>
</body>
</html>

<script>
    let currentSlide = -1;
    let currentArticle = document.URL.split('/').pop().split('#').pop();
    const slides = Array.from(document.getElementsByClassName("artist-card"));
    const videoElem = document.getElementById('lowerVid');
    const videoSrcs = {
        "default": "anderupsidedown",
        "sundei": "sundeibannerbw",
        "afke": "afkeloop2",
        "metropol": "metropol",
        "trellid": "trellid",
        "ossu": "ossu_banner"
    };

    let timeoutID = null; // Tracks slideshow timeout
    let switching = false; // Prevent rapid switching
    let activeContext = Symbol(); // Unique identifier for current article state

    // Utility to clear all pending updates
    function clearPendingUpdates() {
        clearTimeout(timeoutID);
        activeContext = Symbol(); // Invalidate previous operations
    }

    const isAndroidChrome = /Android/i.test(navigator.userAgent) && /Chrome/i.test(navigator.userAgent);

    function forceReflow(element) {
        void element.offsetHeight; // Trigger reflow
    }

    // Update the video source based on the current state
    function updateVideoSource(context) {
        const newSrc = currentArticle === 'artists' && slides[currentSlide]
            ? `./assets/${videoSrcs[slides[currentSlide]?.id] || 'default'}.webm`
            : `./assets/${videoSrcs['default']}.webm`;

        if (videoElem.src !== newSrc) {
            videoElem.style.opacity = 0;
            forceReflow(videoElem); // Ensure opacity change is applied

            setTimeout(() => {
                if (context !== activeContext) return; // Abort if context changed
                videoElem.src = newSrc;
                videoElem.load();

                videoElem.onloadeddata = () => {
                    if (context === activeContext) {
                        videoElem.style.opacity = 1;
                        videoElem.play().catch(() => {
                            console.warn('Playback failed, likely due to autoplay restrictions.');
                        });
                        console.log(currentArticle)
                    }
                };
            }, isAndroidChrome ? 1000 : 500); // Slightly longer delay for Android Chrome
        }
    }

    // Manage slide visibility
    function updateSlides(context) {
        if (context !== activeContext) return; // Abort if the context changed

        slides.forEach((slide, index) =>
            slide.classList.toggle("hidden", index !== currentSlide)
        );
    }

    // Start the slideshow for the 'artists' article
    function showSlides() {
        clearTimeout(timeoutID);
        const context = activeContext;

        if (currentArticle !== 'artists') return; // Stop if not in 'artists'

        currentSlide = (currentSlide + 1) % slides.length;
        updateSlides(context);
        updateVideoSource(context);

        timeoutID = setTimeout(showSlides, 10000); // Schedule next slide
    }

    // Change slides manually
    function changeSlide(step) {
        clearTimeout(timeoutID); // Stop automatic transitions
        const context = activeContext;

        currentSlide = (currentSlide + step + slides.length) % slides.length;
        if (currentArticle === 'artists') {
            updateSlides(context);
            updateVideoSource(context);
            timeoutID = setTimeout(showSlides, 10000); // Resume slideshow
        }
    }

    // Switch to a different article
    function changeArticle(articleName) {
        if (switching) return; // Prevent rapid switching
        switching = true;

        clearPendingUpdates(); // Cancel ongoing updates
        currentArticle = articleName;
        const context = (activeContext = Symbol()); // New unique context

        if (currentArticle === 'artists') {
            currentSlide = -1; // Reset slideshow
            showSlides();
        } else {
            slides.forEach(slide => slide.classList.add("hidden")); // Hide all slides
            videoElem.style.opacity = 0;
            updateVideoSource(context);
        }

        setTimeout(() => (switching = false), 300); // Debounce rapid switches
    }

    // Initialize the slideshow on page load
    window.onload = () => {
        activeContext = Symbol(); // Set initial context
        showSlides();
    };

</script>
